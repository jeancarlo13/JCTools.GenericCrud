@using JCTools.GenericCrud.Helpers
@using Microsoft.AspNetCore.Mvc.Localization
@model JCTools.GenericCrud.Models.ICrudList
@inject IViewLocalizer Localizer

@{
    Layout = Model.LayoutPage;
    ViewData["Title"] = Model.Title;

    Model.NewAction.Url = Url.Action("Create");
    Model.NewAction.UseModals = Model.UseModals;
    Model.DetailsAction.UseModals = Model.UseModals;
    Model.EditAction.UseModals = Model.UseModals;
    Model.DeleteAction.UseModals = Model.UseModals;
    if (Model.UseModals)
    {
        Model.NewAction.OnClientClick = "genericCrud.showModal.call(this)";
        Model.DetailsAction.OnClientClick = Model.NewAction.OnClientClick;
        Model.EditAction.OnClientClick = Model.NewAction.OnClientClick;
        Model.DeleteAction.OnClientClick = Model.NewAction.OnClientClick;        
    }
}

<h2>@Model.Title</h2>
<h3>@Model.Subtitle</h2>
@if (!string.IsNullOrWhiteSpace(Model.Message))
{
    <div class="alert @(Model.MessageClass) alert-dismissible">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button>
        @Model.Message
    </div>
}
<table class="table table-striped table-condensed table-hover">
    <thead>
        <tr>
            @foreach(var title in Model.Columns)
            {
                <th>@title</th>
            }
            @if(Model.ActionsColumnIsVisible)
            {
                <th class="text-center">
                    @Html.Partial("_action", Model.NewAction)
                </th>
            }
        </tr>
    </thead>
    <tbody>
        @foreach(var row in Model.GetModelValues())
        {
            var isSelected = row.FirstOrDefault(v => v.Name == Model.KeyPropertyName)?.Value.Equals( Model.GetId());
            var classAttribute = isSelected.HasValue && isSelected.Value ? "class=\"active\"" : string.Empty;
            <tr @Html.Raw(classAttribute) >
                @foreach(var value in row)
                {
                    if (value.Visible)
                    {
                        <td>@value.Value</td>
                    }
                }
                @if(Model.ActionsColumnIsVisible)
                {
                    <td class="text-center">
                        @{
                            var value = row.FirstOrDefault(d => d.Name == Model.KeyPropertyName).Value;
                            Model.DetailsAction.Url = Url.Action("Details", new { id = value });
                            Model.EditAction.Url = Url.Action("Edit", new { id = value });
                            Model.DeleteAction.Url = Url.Action("Delete", new { id = value });
                        }
                        @Html.Partial("_action", Model.DetailsAction)
                        @Html.Partial("_action", Model.EditAction)
                        @Html.Partial("_action", Model.DeleteAction)
                    </td>
                }
            </tr>
        }
    </tbody>
</table>

<script src="@(Url.Action("GetScript", new { fileName = "genericCrud"}))"></script>